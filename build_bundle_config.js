'use strict';var e=require("@babel/runtime/helpers/interopRequireDefault"),t=e(require("@babel/runtime/helpers/toConsumableArray")),r=e(require("@babel/runtime/helpers/classCallCheck")),i=e(require("@babel/runtime/helpers/createClass")),s=require('metro-config/src/defaults/defaults'),o=s.assetExts,n=(s.sourceExts,require('path')),u=require("fs"),l=(require('commander'),n.posix.sep,"__prelude__"),a={nextSdkId:2,nextBaseId:3,nextPluginId:1},d=require("./bin/config/common"),p=d.project_dir,c=d.SUPPORTED_ASSET_FILE_TYPES,f=d.IDX_ANDROID,h=d.IDX_IOS,g=d.IDX_PATH,M=d.IDX_TYPE,_=n.join(__dirname,"bin","config","modules"),m={};function v(e){if(m[e])return m[e];if(!u.existsSync(_))return process.exit(1007),!1;var t=u.readFileSync(_);return t?(m[e]=new S(e,t),m[e]):(process.exit(1008),!1)}var I,x,b,S=(function(){function e(t,i){var s=this;(0,r.default)(this,e),this.config=JSON.parse(i.toString()||"{}"),this.platFormModules=(this.config.modules||[]).filter(function(e){return e[t]}),this.plugIdMap=new Map,this.pathModuleMap=new Map,(this.config.modules||[]).forEach(function(e){s.pathModuleMap.set(e[g],e)}),this.platform_idx=t,this.get__dModules=this.get__dModules.bind(this),this.get__dIDModulesMap=this.get__dIDModulesMap.bind(this),this.getModulesMap=this.getModulesMap.bind(this),this.getModuleId=this.getModuleId.bind(this)}return(0,i.default)(e,[{key:"get__dModules",value:function(){return this.platFormModules.filter(function(e){return e[M]})}},{key:"get__dIDModulesMap",value:function(){var e=this,t=new Map;return this.get__dModules().forEach(function(r){t.set(r[e.platform_idx],r)}),t}},{key:"getModulesMap",value:function(){return this.pathModuleMap}},{key:"getModuleId",value:function(e){if(e===l)return this.config.prelude_id||1e4;var t=n.relative(p,e).replace(/\\/g,"/"),r=this.plugIdMap.get(t);if(r)return r;var i=this.pathModuleMap.get(t);return i&&i[this.platform_idx]?i[this.platform_idx]:(r||(r=1e4+a.nextPluginId,a.nextPluginId+=3),this.plugIdMap.set(t,r),r)}}]),e})(),D=/^miot-sdk\/.+/,y=/^node_modules\/.+/,q=/^node_modules\/\S*\/polyfills\/.*\.js$/;!(function(){console.log('process.argv',process.argv);var e=process.argv,t=e.indexOf('--platform'),r=e.indexOf('--entry-file'),i=e[t+1]||'android';b=e[r+1].replace('index.js','');var s=v(I='ios'===i?h:f);s?(x=s,e.indexOf("ram-bundle")>=0):console.log("Failed to load modules!")})(),module.exports={resolver:{assetExts:[].concat((0,t.default)(o),(0,t.default)(c))},transformer:{babelTransformerPath:n.join(p,"bin","config","transformerForSDK.js"),minifierConfig:{mangle:{toplevel:!1},output:{ascii_only:!0,quote_style:3,wrap_iife:!0},sourceMap:{includeSources:!1},toplevel:!1,compress:{reduce_funcs:!1}}},serializer:{createModuleIdFactory:function(){var e=x.getModuleId,t=process.cwd();return function(r){var i;if(-1!==r.indexOf(b)){var s=r.substr(t.length+1).replace(b,'');i=e(s)}else i=e(r);return i}},processModuleFilter:function(e){var t=x,r=t.get__dIDModulesMap,i=(0,t.getModulesMap)(),s=r(),o=n.relative(p,e.path).replace(/\\/g,"/");if(-1!==o.indexOf(l))return!1;if(q.test(o))return!1;if(D.test(o))return!1;if(y.test(o)){var u=i.get(o);return!u||!s.get(u[I])}return!0},postProcessBundleSourcemap:function(e){e.code,e.map,e.outFileName}},resetCache:!1};